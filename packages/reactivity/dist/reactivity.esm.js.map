{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/reactiveEffect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export let activeEffect = null\n\nclass ReactiveEffect {\n  public _trackId = 0\n\n  public deps = []\n\n  public _depLength = 0\n\n  public active = true\n\n  constructor(public fn, public scheduler) {\n\n  }\n  run() {\n    if (!this.active) {\n      return this.fn()\n    }\n\n    let lastEffect = activeEffect\n\n    try {\n      // \u4F9D\u8D56\u6536\u96C6\n      activeEffect = this\n      return this.fn()\n    } finally {\n      activeEffect = lastEffect\n    }\n  }\n}\n\nexport function effect(fn, options) {\n  const _effect = new ReactiveEffect(fn, () => {\n    _effect.run()\n  })\n  _effect.run()\n\n  return _effect\n}\n\nexport function trackEffects(effect, dep) {\n  dep.set(effect, effect._trackId)\n  effect.deps[effect._depLength++] = dep\n}\n\nexport function triggerEffects(dep) {\n  for (const effect of dep.keys()) {\n    if (effect.scheduler) {\n      effect.scheduler()\n    }\n  }\n}\n", "export function isObject(val: unknown): val is Record<any, any> {\n  return val !== null && typeof val === 'object'\n}\n", "import { activeEffect, trackEffects, triggerEffects } from \"./effect\"\n\nconst targetMap = new WeakMap()\n\nexport function createDep(cleanup) {\n  const dep = new Map() as any\n  dep.cleanup = cleanup\n  return dep\n}\n\nexport function track(target, key) {\n  if (!activeEffect) return\n\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, depsMap = new Map())\n  }\n\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, dep = createDep(() => depsMap.delete(key)))\n  }\n\n  trackEffects(activeEffect, dep)\n}\n\nexport function trigger(target, key) {\n  const depsMap = targetMap.get(target)\n  if (!depsMap) return\n\n  let dep = depsMap.get(key)\n  if (!dep) return\n\n  triggerEffects(dep)\n}\n", "import { track, trigger } from \"./reactiveEffect\"\n\nexport enum ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive'\n}\n\nexport const mutableHandlers: ProxyHandler<any> = {\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true\n    }\n\n    const result = Reflect.get(target, key, receiver)\n\n    track(target, key)\n\n    return result\n  },\n  set(target, key, value, receiver) {\n    const oldValue = target[key]\n\n    const result = Reflect.set(target, key, value, receiver)\n\n    if (oldValue !== value) {\n      trigger(target, key)\n    }\n\n    return result\n  }\n}\n", "import { isObject } from \"@chibivue/shared\"\nimport { ReactiveFlags, mutableHandlers } from './baseHandler'\n\nconst reactiveMap = new WeakMap()\n\nfunction createReactiveObject(target) {\n  if (!isObject(target)) {\n    return target\n  }\n\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  const existingProxy = reactiveMap.get(target)\n  if (existingProxy) {\n    return existingProxy\n  }\n\n  const proxy = new Proxy(target, mutableHandlers)\n  reactiveMap.set(target, proxy)\n  \n  return proxy\n}\n\nexport function reactive(target) {\n  return createReactiveObject(target)\n}\n"],
  "mappings": "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",
  "names": ["effect"]
}
